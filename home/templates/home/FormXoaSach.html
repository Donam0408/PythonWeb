{% extends 'home/base.html' %}

{% block content %} 
<form action="/home/DeleteSach/" method="post">
    {% csrf_token %}
    <label for="">Nhập mã sách</label><br>{{form.maSach}}<br>
    <input type="submit" name="Xóa" value="Xóa">
</form>
    <br><br>
    <h1>Danh Sach Sach Trong Thu Vien</h1>
<table border="1" class="table table-striped table-sm">
    {% if ds%}
            <td style="color:red;">Mã Sách</td>
            <td style="color:red;">Tên Sách </td>
            <td style="color:red;">Loại Sách</td>
            <td style="color:red;">Tác Giả</td>
            <td style="color:red;">Nhà xuất bản</td>
            <td style="color:red;">Năm xuất bản</td>
            <td style="color:red;">Trạng thái</td>
        {% for x in ds%}
        <tr class="record">
            <td style="color:red;">{{x.maSach}}</td>
            <td style="color:red;">{{x.tenSach}} </td>
            <td style="color:red;">{{x.tenTG}}</td> 
            <td style="color:red;"> {{x.loaiSach}}</td>
            <td style="color:red;">{{x.nhaXB}} </td>
            <td style="color:red;"> {{x.namXB}}</td>
             {% if x.trangThaiSach %}
                <td style="color:red;">Không thể mượn</td> 
             {% else %}
                <td style="color:red;">Có thể mượn</td>
             {% endif %}
            <td><a href="/home/delete_S/{{ x.id }}" method="post" class="delete_s"><button>Xóa</button></a></td>
        </tr>
        {% endfor %}
    {% else %}
        <h3 style="color:red;">Không có dữ liệu nào</h3>
    {% endif %}
</table>
{% endblock %}
{% block javascript %}
<script>
    $(".delete_s").on("click", function (e) {
        e.preventDefault();
        // get the nickname
        var $this = $(this);
        // GET AJAX request
        if (confirm("Xóa bản ghi?")){
            $.ajax({
                url: $this.attr("href"),
                type : "GET",
                dataType: "json",
                success: function(response){
                    if (response.mess == 'success'){
                        $this.parents('.record').fadeOut("slow",function(){
                            $this.parents('.record').remove();
                        });
                    }
                    else{
                        alert(response.mess);
                    }
                },
                error: function(response){
                    console.log("ERROR!!!");
                },
            })
       
        }
    })

    $("#id_maSach").focusout(function (e) {
        e.preventDefault();
        // get the nickname
        var maSach = $(this).val();
        // GET AJAX request
        $.ajax({
            type: 'GET',
            url: "{% url 'validate_sach' %}",
            data: {"maSach": maSach },
            success: function (response) {
                // if not valid user, alert the user
                if(response["valid"]){
                    alert("Mã sách bạn nhập không tồn tại");
                    var maDG = $("#id_maSach");
                    maDG.val("")
                    
                }
            },
            error: function (response) {
                console.log(response)
            }
        })
    })
</script>
{% endblock %}