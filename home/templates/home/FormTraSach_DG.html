{% extends 'home/base_PMS2.html' %}

{% block content %} 
<!--
<script>
    function formatDate()
    {
        const options = { day: "numeric", month: "long", year: "numeric" };
        date_collection = document.getElementsByClassName('date');
        for(var i = 0; i< date_collection.length; i++)
        {
            var datetime = new Date(Date.parse(date_collection[i].innerHTML));
            alert(datetime);
            const americanDate = new Intl.DateTimeFormat("en-US", options).format(datetime);
            date_collection[i].innerText = americanDate;
            date_collection[i].setAttribute("time",datetime);
        }
    }
    </script>
-->
<h2>Đăng Kí Trả Sách</h2>

<form id="ts_form" action="/home/TraSach/" method="post">
    {% csrf_token %}
    
    
    <label for="">Nhập mã đọc giả</label><br>{{form.maDG}}<br>

    <label for="">Nhập mã sách</label><br> {{form.maSach}}<br>

    <label for="">Nhập ngày trả</label><br>{{form.ngayTra}}
    
    <br><br>
    <input class="btn btn-primary" type="submit" name="dangki" value="Đăng Kí Trả Sách">
    <br><br>
   
</form>

{% endblock %}
{% block javascript %}
<script>
$("#ts_form").submit(function (e) {
    // preventing from page reload and default actions
    e.preventDefault(); 
    $.ajax({
        type: 'POST',
        url: "{% url 'traSach_DG' %}",
        data: {
            "maDG": $("#id_maDG").val(),
            "maSach":$("#id_maSach").val(),
            "ngayTra" : $("#id_ngayTra").val(),
             csrfmiddlewaretoken : $('input[name = csrfmiddlewaretoken]').val(),

        },
        success: function (response) {
            // on successfull creating object
            if(response["valid"]){
                if(response.mess == 1){
                    alert("Ngày trả bạn nhập không hợp lệ");
                }
                else if(response.mess == 2){
                    alert("Trả sách muộn!!");
                    alert("Đăng kí trả sách thành công");
                    $("#ts_form").trigger('reset');   
                }
                else {
                    alert("Đăng kí trả sách thành công");
                    $("#ts_form").trigger('reset');   
                }
            }
            else{
                alert("Không tìm thấy phiếu mượn sách (Kiểm tra lại mã sách hoặc mã sinh viên)");
            }
            
        },
        error: function (response) {
            // alert the error if any error occured
            alert(response["error"]);
        }
    })
})
</script>
{% endblock %}

