{% extends 'home/base.html' %}

{% block content %} 
<form action="/home/AlterSach/" method="post" id="sach-form">
    {% csrf_token %}
    
    <label for="">Nhập mã sách cần sửa</label><br><input type="text" name="maSach" maxlength="50" required id="id_maSach"><br>
    <h3>Sửa thông tin sách</h3>
    <label for="">Nhập tên sách</label><br>  <input type="text" name="tenSach" maxlength="100"  id="id_tenSach"><br>
    
    <label for="">Nhập loại sách</label><br><input type="text" name="loaiSach" maxlength="50" id="id_loaiSach"><br>

    <label for="">Nhập tác giả</label><br><input type="text" name="tenTG" maxlength="100" id="id_tenTG"><br>

    <label for="">Nhập nhà xuất bản</label><br><input type="text" name="nhaXB" maxlength="100"  id="id_nhaXB"><br>

    <label for="">Nhập năm xuất bản</label><br><input type="number" name="namXB" id="id_namXB"><br>

    <label for="">Trạng thái sách </label><br><select name="trangThaiSach" id="id_trangThaiSach">
        <option value="0" selected>Có thể mượn</option>
      
        <option value="1">Không thể mượn</option>
      
        
      
      </select><br><br>


    <input class="btn btn-primary" type="submit" name="dangki" value="Sửa">
</form>
<h1>Danh Sach Sach Trong Thu Vien</h1>
<table border="1" class="table table-striped table-sm">
    {% if ds%}
            <td style="color:red;">Mã Sách</td>
            <td style="color:red;">Tên Sách </td>
            <td style="color:red;">Loại Sách</td>
            <td style="color:red;">Tác Giả</td>
            <td style="color:red;">Nhà xuất bản</td>
            <td style="color:red;">Năm xuất bản</td>
            <td style="color:red;">Trạng thái</td>

        {% for x in ds%}
        <tr>
            <td style="color:red;">{{x.maSach}}</td>
            <td style="color:red;">{{x.tenSach}} </td> 
            <td style="color:red;"> {{x.loaiSach}}</td>
            <td style="color:red;">{{x.tenTG}}</td>
            <td style="color:red;">{{x.nhaXB}} </td>
            <td style="color:red;"> {{x.namXB}}</td>
            {% if x.trangThaiSach %}
                    <td style="color:red;">Không thể mượn</td> 
            {% else %}
                    <td style="color:red;">Có thể mượn</td>
            {% endif %}
        </tr>
        {% endfor %}
    {% else %}
        <h3 style="color:red;">Không có dữ liệu nào</h3>
    {% endif %}
</table>
{% endblock %}
{% block javascript %}
<script>

     $("#sach-form").submit(function (e) {
    // preventing from page reload and default actions
    e.preventDefault(); 
    var maSach = $("#id_maSach").val();
    $.ajax({
        type: 'POST',
        url: "{% url 'alterSach' %}",
        data: { "maSach": maSach,
                "tenSach": $("#id_tenSach").val(),
                "tenTG": $("#id_tenTG").val(),
                "loaiSach": $("#id_loaiSach").val(),
                "nhaXB": $("#id_nhaXB").val(),
                "namXB": $("#id_namXB").val(),
                "trangThaiSach": $("#id_trangThaiSach").val(),
                csrfmiddlewaretoken : $('input[name = csrfmiddlewaretoken]').val(),
    },
        success: function (response) {
            if(!response["valid"]){
                alert("Mã sách bạn nhập không tồn tại");
            }
            else {
                alert("Sửa thông tin sách thành công");
            }
            
        },
        error: function (response) {
            // alert the error if any error occured
            alert(response["responseJSON"]["error"]);
            
        }
    })
}) 
$("#id_maSach").focusout(function (e) {
    e.preventDefault();
    // get the nickname
    var maSach = $(this).val();
    // GET AJAX request
    $.ajax({
        type: 'GET',
        url: "{% url 'validate_sach' %}",
        data: {"maSach": maSach },
        success: function (response) {
            // if not valid user, alert the user
            if(response["valid"]){
                alert("Mã sách bạn nhập không tồn tại");
                
            }
        },
        error: function (response) {
            console.log(response)
        }
    })
})

</script>
{% endblock %}